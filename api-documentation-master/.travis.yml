language: python
python:
- '3.6'
cache:
  - pip
  - npm
  - directories:
    - .cache
    - /home/travis/.nvm
env:
  global:
    # Upload credentials
    - secure: b8TWocQTpbCx91Nqs9bxKvrY7QHg2NyFZgfgnEnzM5zjt9glSpYQngdLht7Qq+Am5jSXgcjkZK4cfE1Hp+ynKhinNYycBHXPUFcOh4uD1rlRhZd6QX7ukVU+T3wxQjeZuAkB4fnpidEC6TW4Mhkt7fQwhQoxGmf3woz23gIOCMQ53EvRs8jGkRLn7pABB1LI0N0pfLB2KMKgmU7kEO2OnbBGvwfw1PV5/XLl5qMQhEYcm65jYgmHMjyhYSvaVjSYBXfdU1zyUDDWZ7S8HAl3+O1Hk9cQ1rLZwPgQHqVoLbjI3wHRy38KUqP6Et5ZxDHwkesw2x/wni068GwYfXAveWwYarPA8ybtYDQ3sEdeKiDz6JJYX3U+rmprfsNxNlqxOSfEi6A0DnhpCqq9aoythEYR7WF+29BR+xdSOjfi2rFWRVXhYdBKoHnJY1Zw0XJYi1mfyxNHdJPsc9ZSWChF/Zl48Rhya7ISamTw6CkJd/wylraakIk9kFcKzSDnGTcRoNaYACWjVkgDmclfDg9Kkr1MeBtJcXbS1sYL196Zjna7BuWchXEiqsm2e4FK8CFx2mu1ymqrZgC6zubRPW007TUnXigHuZmUj9U3Fd8gw1fmGhN7R0wA0swtN6CidyWJ8vNaa+/kuQS7ipH4PBtL/AHAmVVISudxOfQU0XFD5PI=
    - secure: n3c0R7PDpKjb0UR5OsmTosBYIJHf3gH324wJF9iGZaalNEXqgqJPjQldjiNKKy733I977sYiQQPd2IH00C0ZR6gBQNOLowzMKNrAr68X7ND2MCnjmMEuhEMrdfdMlM9QGtxEtI30JSvKtBBecj3NNc86elL0zAOTcKcA2lY/GdVoGfsKPvLzui75tsGpPf453+qg2h7PR0r/5duQEgQSSoywt6F4LdhxJJQKG7gg2eZmzPUOst4033t/yU/ALbmw6QbKEgr8IWCMyU1qD/hq828VOjPbn++XAX6fxdWUhLqo6cCiTNFdqb1qTkQQ+i/hcCWL+GoEfF6VVaxfpw5anDAg+35llCJE8keuiFBdrvzOJxs9l144TdG6mQmSrqlwrz5GDsoyaV2Gvgq+PfTDTAPshN6ObGuiY9i0X1dOxtewZLsZ2yELgen/0bl2db47WFWoxNiTLPFrmWpfkKgk4KNU3D5yOxR3NKerbq53UWMPXyad4HtyaGES2/2I+x7B5YXWsZoaHyG/ZrUx1I0pG7en5xKMWRsl8Y1bOa8t25xonrgBhtgc9EYlzIv99rYgZvumg26kiOS7NpF04IBa9yn/8BH/HPZ8gc3ZSABbDEB6rv5iF9W5BotApcKvzrFochUtMgH69vEKf1g2ULh18CRbBxr4AU2fkliCeHlc+0Q=
    # CloudFront credentials
    - secure: Duu5/XtdMQym6uZ+EbWv9Y04e+7pIZjVYrVKJMwN6prj+cMcQtfEOSntFFfqE/g9bcnhb+p9htAVxWXO9iU0EauD9W45X4F2gPY4AiiNE8f73VhnIYZELHqOE+h3uQBZHdu/VqRn6Ao1ovh8hL9G6PtgjJ674IouMfZ823MCxjbf1s/Af52BTqTx5i81O3xX0LknCJmSwp0Muwnua1+k/RHIIoRWqV06nOVn1WVatgDz1cP7a751cCKfTOeMFoYepVaKlh+T3+2hgx4zj23S5Z2w7wv9FSGyzk0pvXq2dbHcL1TZYswixWFetw1xSx8T9wyMKxoHWzgSrhqJ/VxPTv/Ox86YQCWHoMfBnURUSAbUBSCboWi9ssTNt7oRDjt6QCmxuL1IfUsL/4wRWwVu5cJJvvtPkih+s41H3ejPpTeLxyi0JHPoRa5hoiGBjVrXj/4pD5HeruMEl+M5TPkJ0gLSx762RqzWMmYUlJKcaZZJ4wVllftT8U5Yt8tR/t3DHAa2GSvKkMSN3oz1LpPeQrzTacm+nAOo2C0grSPrdnxmo0l3aCYGNyUhtStxV467IcyMVtR/XH327+fOECJo/mSFCo0X0PeaOD4aex8rBS3RnQhOPxFPv8JkLE0DbMzXNDbYJeoYaUtXaJuJ4RKs0BugpeeirXADJxvm0X3doMU=
    - secure: xGU7E+6E9jzjUmPaT3JPcr2EYfX0XaqsKekFuRcDvs904ky8LsDN2xpa9FvlGn0G3qgv5lDhqjyV6b8C8X4Dy3HNJrsMaE0AYVm5Sz89t+CBBSoDUvqBzOYRS8e3+oXILR2DjMxp+TPl+NmYM4LmrjHWcSPAEFoe2B3ofqW3DBM5ecxoqGA6eB4xz9pGtU7YQTWAe9OFBwcYBmQNmhRQHYDtdHvsVtaRuLeOT3qif6qhS3cCm1SVXkPj3j+JFrhJE/el7RT9kHhMF73FhFjPAQ7WTJxRc6s70SEQBT7lMlOA2L65g/aS63GOAl0qMwjSDf4n+SaynF4E6e9VbVZrM57G/XreEIDaOrfodwKtowwHFon3TSNinTXPJH/tp6+TudgYpjjzK6MqieAcd8vWIjEhpFVUEe2tCNf1K/69SZj21PTxZastQ0QTifT+8UVdMY6pDFy7KRr0gfDwIn2pjGvPagXMjBqwd7+eku1+32Hk2wD8GAir/dE4oAsWOEeWvnQDolH7pfdcneTxSNbDjjp1UKQGQ0d5DiXdcEEGnY3kzgA9jEEYT8oK4KaEzxpUtZ82ZCeF3l0A6YY1Ock/IJ0zjgJRxA4lD6y1pco9uiEXGZkxjmOBtBjc6KQpKvV/hZpPmYfZtwnAHeahzJZy3vDZWJlDUfRV8pxEvbieRd8=
    - AWS_BUCKET="20180313-docs"
    - AWS_REGION="eu-central-1"
install:
  - nvm install $(cat .nvmrc)
  - travis_retry npm install --no-optional --no-audit
  - pip install -r requirements.txt
script:
  - make html-production
before_deploy:
  - pip install awscli
deploy:
  on:
    branch: master
  provider: script
  script: bash deploy.sh
  skip_cleanup: true
after_deploy:
  # Bust the CloudFront edge cache, invalidate every object in the distribution
  - aws cloudfront create-invalidation --distribution-id ${CLOUDFRONT_DISTRIBUTION_ID} --paths "/*"
  - aws cloudfront create-invalidation --distribution-id ${CLOUDFRONT_DISTRIBUTION_CDN_ID} --paths "/*"
